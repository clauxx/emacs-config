(use-package perspective
  :custom
  (persp-suppress-no-prefix-key-warning t)
  (persp-modestring-short t)
  :init
  (persp-mode))

(add-hook 'kill-emacs-hook #'persp-state-save)

(with-eval-after-load 'perspective
  (consult-customize consult--source-buffer :hidden t :default nil)
  (add-to-list 'consult-buffer-sources persp-consult-source))

(with-eval-after-load 'general
  (general-define-key
   :states '(normal visual)
   :keymaps 'cl/keys-mode-map
   :prefix cl/leader
   "p" '(:ignore t :wk "Perspective (workspaces)")
   "p p" '(persp-switch :wk "Switch perspective")
   "p j" '(persp-next :wk "Next perspective")
   "p k" '(persp-next :wk "Next perspective")
   "p k" '(persp-kill :wk "Kill a perspective")))

(provide 'perspective-pkg-archive)
